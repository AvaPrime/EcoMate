{% extends "base.html" %}

{% block extrahead %}
  <!-- Enhanced theme toggle meta tags -->
  <meta name="color-scheme" content="light dark">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#1976d2">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1565c0">
  
  <!-- Preload theme assets for faster switching -->
  <link rel="preload" href="{{ 'assets/stylesheets/extra.css' | url }}" as="style">
  <link rel="preload" href="{{ 'assets/javascripts/theme-toggle.js' | url }}" as="script">
  
  <!-- Custom favicon for different themes -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%231976d2' d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z'/%3E%3C/svg%3E">
  
  <style>
    /* Prevent flash of unstyled content during theme switch */
    .theme-switching * {
      transition: none !important;
    }
    
    /* Loading indicator for theme switch */
    .theme-loading::after {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--md-primary-fg-color), transparent);
      animation: loading 1s ease-in-out;
      z-index: 9999;
    }
    
    @keyframes loading {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
  </style>
{% endblock %}

{% block header %}
  {{ super() }}
  
  <!-- Enhanced theme toggle accessibility -->
  <script>
    // Immediate theme application to prevent flash
    (function() {
      const savedTheme = localStorage.getItem('ecomate-theme-preference');
      if (savedTheme) {
        document.body.setAttribute('data-md-color-scheme', savedTheme);
      }
    })();
  </script>
{% endblock %}

{% block footer %}
  {{ super() }}
  
  <!-- Theme toggle status indicator -->
  <div id="theme-status" style="display: none; position: fixed; bottom: 20px; right: 20px; background: var(--md-primary-fg-color); color: white; padding: 8px 16px; border-radius: 20px; font-size: 12px; z-index: 1000; opacity: 0; transition: opacity 0.3s ease;">
    Theme switched!
  </div>
  
  <script>
    // Show theme switch notification
    document.addEventListener('themeChanged', function(event) {
      const status = document.getElementById('theme-status');
      const themeName = event.detail.scheme === 'slate' ? 'Dark' : 'Light';
      status.textContent = `Switched to ${themeName} mode`;
      status.style.display = 'block';
      status.style.opacity = '1';
      
      setTimeout(() => {
        status.style.opacity = '0';
        setTimeout(() => {
          status.style.display = 'none';
        }, 300);
      }, 2000);
    });
    
    // Add keyboard shortcut hint to toggle button
    document.addEventListener('DOMContentLoaded', function() {
      const toggleButtons = document.querySelectorAll('[data-md-toggle="palette"]');
      toggleButtons.forEach(button => {
        button.setAttribute('title', button.getAttribute('title') + ' (Ctrl+Shift+T)');
      });
    });
  </script>
{% endblock %}